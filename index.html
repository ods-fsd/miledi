<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM –ê–ª—ñ–Ω–∏ –ë–æ–∫–æ–≤–æ—ó</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <h1 class="text-4xl font-extrabold text-pink-600 mb-2">üíÖ –ú—ñ–Ω—ñ-CRM "Esteta"</h1>
            <p class="text-gray-500">
                –ü–µ—Ä–µ–≥–ª—è–¥ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ—ó –±–∞–∑–∏ —Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤.
            </p>
        </header>

        <!-- API URL & Status -->
        <div id="status-message" class="bg-blue-100 border-l-4 border-blue-500 text-blue-700 p-4 rounded-lg mb-6 shadow-md">
            <p class="font-bold">–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</p>
            <p>1. –ü–∞–º'—è—Ç–∞–π **–Ω–µ —Å–ø—ñ—à–∏ :)**</p>
        </div>
        
        <!-- Action Button (Add Client) -->
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-semibold text-gray-700">–£—Å—ñ –∫–ª—ñ—î–Ω—Ç–∏</h2>
            <button id="show-form-btn" onclick="toggleForm()" class="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-xl shadow-lg transition duration-200 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞
            </button>
        </div>

        <!-- Add Client Form (Initially Hidden) -->
        <div id="add-client-form-container" class="bg-white p-6 rounded-2xl shadow-xl mb-8 hidden">
            <h3 class="text-xl font-semibold mb-4 text-gray-800">–ù–æ–≤–∏–π –∑–∞–ø–∏—Å</h3>
            <form id="client-form" onsubmit="addClient(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Name -->
                    <div class="col-span-1">
                        <label for="name" class="block text-sm font-medium text-gray-700">–Ü–º'—è –∫–ª—ñ—î–Ω—Ç–∞</label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-pink-500 focus:border-pink-500 border">
                    </div>
                    <!-- Phone -->
                    <div class="col-span-1">
                        <label for="phone" class="block text-sm font-medium text-gray-700">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="phone" name="phone" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-pink-500 focus:border-pink-500 border">
                    </div>
                    <!-- Date -->
                    <div class="col-span-1">
                        <label for="visitDate" class="block text-sm font-medium text-gray-700">–î–∞—Ç–∞ –≤—ñ–∑–∏—Ç—É</label>
                        <input type="date" id="visitDate" name="visitDate" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-pink-500 focus:border-pink-500 border">
                    </div>
                    <!-- Time -->
                    <div class="col-span-1">
                        <label for="visitTime" class="block text-sm font-medium text-gray-700">–ß–∞—Å –≤—ñ–∑–∏—Ç—É</label>
                        <input type="time" id="visitTime" name="visitTime" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-pink-500 focus:border-pink-500 border">
                    </div>
                    <!-- Service -->
                    <div class="md:col-span-2">
                        <label for="service" class="block text-sm font-medium text-gray-700">–ü–æ—Å–ª—É–≥–∞</label>
                        <input type="text" id="service" name="service" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 focus:ring-pink-500 focus:border-pink-500 border">
                    </div>
                </div>
                <!-- Submit Button -->
                <div class="mt-6 flex justify-end">
                    <button type="submit" id="submit-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition duration-200">
                        –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å
                    </button>
                </div>
                <div id="form-message" class="mt-4 text-center font-medium"></div>
            </form>
        </div>

        <!-- Clients List -->
        <div id="client-list-container" class="bg-white p-6 rounded-2xl shadow-xl">
            <div id="client-list-body" class="space-y-4">
                <div class="text-center p-8 text-gray-500" id="loading-indicator">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...</div>
                <!-- Client cards will be injected here -->
            </div>
        </div>

    </div>

    <script>
        // *** 1. –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø API ***
        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        // –í–°–¢–ê–í–õ–ï–ù–ï –í–ê–®–ï –ü–û–°–ò–õ–ê–ù–ù–Ø –ù–ê WEB APP
        const APPS_SCRIPT_API_URL = "https://script.google.com/macros/s/AKfycbx_MaqGlq42b1nbzxv9UuY1qG355MolUA0JDa5nnposNpC9PUQGMWNPNr1LOZfO58Nq/exec"; 
        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        // *** 2. –§–£–ù–ö–¶–Ü–á –Ü–ù–¢–ï–†–§–ï–ô–°–£ ***

        function toggleForm() {
            const formContainer = document.getElementById('add-client-form-container');
            const button = document.getElementById('show-form-btn');
            const isHidden = formContainer.classList.toggle('hidden');
            
            if (isHidden) {
                button.innerHTML = '<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞';
            } else {
                button.innerHTML = '–°—Ö–æ–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É';
            }
        }
        
        function displayMessage(type, text, targetId = 'form-message') {
            const msgEl = document.getElementById(targetId);
            msgEl.textContent = text;
            msgEl.className = 'mt-4 text-center font-medium p-3 rounded-lg';
            if (type === 'success') {
                msgEl.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                msgEl.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'loading') {
                 msgEl.classList.add('bg-blue-100', 'text-blue-800');
            } else {
                msgEl.classList.add('text-gray-600');
            }
        }

        function createClientCard(client) {
            const card = document.createElement('div');
            card.className = 'bg-gray-50 p-4 rounded-xl border border-gray-200 shadow-sm transition hover:shadow-md';
            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <p class="text-xl font-bold text-gray-800">${client.name}</p>
                    <p class="text-sm text-gray-500 bg-gray-200 py-1 px-3 rounded-full">
                       –û—Å—Ç–∞–Ω–Ω—ñ–π –≤—ñ–∑–∏—Ç: ${client.lastVisit || '–ù–µ–≤—ñ–¥–æ–º–æ'}
                    </p>
                </div>
                <p class="text-pink-600 font-medium mt-1">${client.phone}</p>
                <p class="text-sm text-gray-600 mt-2">
                    <span class="font-semibold">–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è:</span> ${client.dob || '‚Äî'}
                </p>
            `;
            return card;
        }


        // *** 3. –§–£–ù–ö–¶–Ü–á –í–ó–ê–Ñ–ú–û–î–Ü–á –ó API (Google Apps Script) ***
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–ª—ñ—î–Ω—Ç—ñ–≤
        async function loadClients() {
            const listBody = document.getElementById('client-list-body');
            const loadingIndicator = document.getElementById('loading-indicator');
            listBody.innerHTML = ''; // –û—á–∏—â–∞—î–º–æ —Å–ø–∏—Å–æ–∫
            loadingIndicator.style.display = 'block';

            // *** MOCK DATA (–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—ó –¥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è API) ***
            const mockClients = [
                { name: "–û–ª–µ–Ω–∞ –ö–æ–≤–∞–ª—å", phone: "380971234567", lastVisit: "20.09.2025", dob: "15.03" },
                { name: "–ú–∞—Ä–∏–Ω–∞ –ó—ñ–Ω—á–µ–Ω–∫–æ", phone: "380669876543", lastVisit: "28.09.2025", dob: "05.11" },
                { name: "–ö–∞—Ç–µ—Ä–∏–Ω–∞ –°–º—ñ—Ä–Ω–æ–≤–∞", phone: "380631112233", lastVisit: "01.10.2025", dob: "‚Äî" },
            ];

            try {
                // –Ø–∫—â–æ APPS_SCRIPT_API_URL –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —Å–ø—Ä–æ–±—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Ç
                if (APPS_SCRIPT_API_URL !== "YOUR_APPS_SCRIPT_URL_HERE") {
                    const response = await fetch(APPS_SCRIPT_API_URL + "?action=getClients", { method: 'GET' });
                    const data = await response.json();
                    
                    if (data && data.success) {
                        data.clients.forEach(client => listBody.appendChild(createClientCard(client)));
                    } else {
                        throw new Error(data.message || "–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –¥–∞–Ω–∏—Ö.");
                    }
                   
                } else {
                    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ MOCK, —è–∫—â–æ URL –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    mockClients.forEach(client => listBody.appendChild(createClientCard(client)));
                }

            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:", error);
                listBody.innerHTML = `<div class="text-center text-red-600 p-4">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –¥–∞–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL API —Ç–∞ –∫–æ–Ω—Å–æ–ª—å.</div>`;
            } finally {
                loadingIndicator.style.display = 'none';
                if (listBody.innerHTML === '') {
                     listBody.innerHTML = `<div class="text-center p-8 text-gray-500">–ù–µ–º–∞—î –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤.</div>`;
                }
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫–ª—ñ—î–Ω—Ç–∞
        async function addClient(event) {
            event.preventDefault();
            
            const form = document.getElementById('client-form');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            displayMessage('loading', '–ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö...');

            // –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–∏—Ö –¥–ª—è GAS (Apps Script –æ—Ç—Ä–∏–º—É—î POST-–∑–∞–ø–∏—Ç–∏ —è–∫ –æ–±'—î–∫—Ç 'postData')
            const payload = {
                action: 'addClient',
                ...data
            };
            
            try {
                // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –ó–º—ñ–Ω–µ–Ω–æ Content-Type –Ω–∞ 'text/plain', —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–º–∏–ª–∫–∏ CORS pre-flight
                const response = await fetch(APPS_SCRIPT_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain;charset=utf-8', 
                    },
                    body: JSON.stringify(payload)
                });
                
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ–º–∏–ª–∫—É HTTP
                if (!response.ok) {
                    throw new Error(`–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ –∞–±–æ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status} ${response.statusText}.`);
                }

                const result = await response.json();
                
                if (result.success) {
                    displayMessage('success', result.message);
                    form.reset();
                    loadClients(); // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫
                } else {
                    displayMessage('error', result.message);
                }

            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:", error);
                displayMessage('error', error.message || '–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ API. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å.');
            }
        }


        // *** 4. –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ***

        window.onload = loadClients;
    </script>
</body>
</html>
